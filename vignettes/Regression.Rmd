---
title: "Regression"
author: "David Gerbing"
output: 
  rmarkdown::html_vignette:
    toc: true
vignette: >
  %\VignetteIndexEntry{3. Models: Least-Squares, Logistic}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---

```{r}
library("lessR")
```

The `Regression()` function performs multiple facets of a complete regression analysis. Abbreviate with `reg()`.


To illustrate, first read the Employee data included as part of __lessR__.

```{r read}
d <- Read("Employee")
```


## Default Analysis 

### Brief output

The brief version provides just the basic analysis, what Excel provides, plus a scatterplot with the regression line, which becomes a scatterplot matrix with multiple regression.

```{r fig.width=4.5, fig.height=4.5}
reg_brief(Salary ~ Years + Pre)
```

### Full output

The full output is extensive: Summary of the analysis, estimated model, fit indices, ANOVA, correlation matrix, collinearity analysis, best subset regression, residuals and influence statistics, and prediction intervals.

```{r}
reg(Salary ~ Years + Pre)
```

Brief output with standardization of all variables in the model. Plot the residuals as a line connecting each data point to the corresponding point on the regression line.

```{r, fig.width=4.5, fig.height=4}
reg_brief(Salary ~ Years, rescale="z", plot_errors=TRUE)
```


### k-fold cross-validation

The standard output includes $R^2_{press}, the value of $R^2$ when applied to new, previously unseen data. Still, a cross-validation option is also offered with the `kfold` parameter. Here specify three folds.

```{r}
reg(Salary ~ Years, kfold=3)
```



## Output as a Stored Object

The output of `Regression()` can be stored into an R object, here named _r_. The output object consists of various components, what R calls a _list_ object.

```{r}
r <- reg(Salary ~ Years + Pre)
```

Entering the name of the object displays the full output.

```{r}
r
```

Or, work with the components individually. Use the base R `names()` function to identify all of the components. Component names that begin with `out_` are part of the standard output. Other components include just data and statistics designed to be input in additional procedures.

```{r}
names(r)
```

Here just display the estimates as part of the standard output.

```{r}
r$out_estimates
```


Here display the coefficients.

```{r}
r$coefficients
```


## Contrasts

Because `reg()` accomplishes its computations with base R functions `lm()`, can pass `lm()` parameters to `reg()`, which then passes their values to `lm()`. Here first use base R function `contr.sum()` to calculate an effect coding contrast matrix for a categorical variable with three levels, such as the variable _Plan_ in the _Employee_ data set.

```{r}
cnt <- contr.sum(n=3)
cnt
```

Now use the `lm()` parameter `contrasts` to define the effect coding for _Plan_, passed to `reg_brief()`. Contrasts only apply to factors, so first convert _Plan_ to a factor.

```{r fig.width=4.5, fig.height=4}
d$Plan <- factor(d$Plan)
reg_brief(Salary ~ Plan, contrasts=list(Plan=cnt))
```


## Null Model

The $R^2$ fit statistic compares the sum of the squared errors of the model with the X predictor variables to the sum of squared errors of the null model.  The baseline of comparison, the null model, is a model with no X variables such that the fitted value for each set of X values is the mean of response variable $y$. The corresponding slope intercept is the mean of $y$, and the standard deviation of the residuals is the standard deviation of $y$.

The following submits the null model for _Salary_, and plots the errors. Compare the standard deviation of the residuals to a regression model of _Salary_ with one or more predictor variables.

```{r fig.width=5}
reg_brief(Salary ~ 1, plot_errors=TRUE)
```



## Interpreted Output

The parameter `Rmd` creates an R markdown file that is automatically generated and  html document from knitting the various output components together with full interpretation. A new, much more complete form of computer output.

Not run here.

```
reg(Salary ~ Years + Pre, Rmd="eg")
```

## Logistic Regression

```{r fig.width=4, fig.height=4}
Logit(Gender ~ Salary)
```

Specify multiple logistic regression with the usual R formula syntax. Specify additional probability thresholds beyond just the default 0.5 with the `prob_cut` parameter.

```{r
Logit(Gender ~ Years + Salary, prob_cut=c(.3, .5 .7))
```


## Full Manual

Use the base R `help()` function to view the full manual for `Regression()`. Simply enter a question mark followed by the name of the function, or its abbreviation.

```
?reg
```

